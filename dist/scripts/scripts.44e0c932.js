"use strict";var app=angular.module("angularRouteMapApp",["routeMapServices","routeMapDirective","routeMapController","ngCookies","ngSanitize","ui.router","ui.bootstrap","restangular","google-maps","ngAutocomplete"]);app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/main"),a.state("main",{url:"/main",templateUrl:"views/main.html",controller:"MainCtrl"}).state("morning_route",{url:"/morning_route",templateUrl:"views/route.html",resolve:{routes:["Restangular",function(a){return a.all("route/morning").getList().then(function(a){return a},function(a){return console.log(a),[]})}],title:[function(){return"Day Routes"}],prefix:[function(){return"morning"}]},controller:"RouteCtrl"}).state("morning_route_map",{url:"/morning/route_map",templateUrl:"views/route_map.html",controller:"RouteMapCtrl",resolve:{selectedShift:[function(){return"Day"}]}}).state("evening_route",{url:"/evening_route",templateUrl:"views/route.html",resolve:{routes:["Restangular",function(a){return a.all("route/evening").getList().then(function(a){return a},function(a){return console.log(a),[]})}],title:[function(){return"Night Routes"}],prefix:[function(){return"evening"}]},controller:"RouteCtrl"}).state("evening_route_map",{url:"/evening/route_map",templateUrl:"views/route_map.html",controller:"RouteMapCtrl",resolve:{selectedShift:[function(){return"Night"}]}}).state("meeting_route",{url:"/meeting_route",templateUrl:"views/route.html",resolve:{routes:["Restangular",function(a){return a.all("route/meeting").getList().then(function(a){return a},function(a){return console.log(a),[]})}],title:[function(){return"Meeting Routes"}],prefix:[function(){return"meeting"}]},controller:"RouteCtrl"}).state("meeting_route_map",{url:"/meeting/route_map",templateUrl:"views/route_map.html",controller:"RouteMapCtrl",resolve:{selectedShift:[function(){return"Meeting"}]}}).state("create_route",{url:"/create_route",templateUrl:"views/create_route.html",controller:"CreateRouteCtrl"})}]),app.config(["RestangularProvider",function(a){a.setBaseUrl("/api/v1"),a.addResponseInterceptor(function(a,b,c){var d=a;return"getList"===b&&(_.isEqual(c,"route/evening")||_.isEqual(c,"route/morning")||_.isEqual(c,"route/names/morning")||_.isEqual(c,"route/names/evening")||_.isEqual(c,"route/meeting")||_.isEqual(c,"route/names/meeting"))&&(d=a.routes),d})}]);var app=angular.module("routeMapController",[]);app.controller("RouteCtrl",["$scope","routes","title","prefix",function(a,b,c,d){a.title=c,a.routes=b,a.config={prefix:d},a.showButton=[],_(b.length).times(function(){a.showButton.push({text:"Show",collapse:!0})}),a.setShowButtonText=function(b){a.showButton[b].text=_.isEqual(a.showButton[b].text,"Show")?"Collapse":"Show",a.showButton[b].collapse=!a.showButton[b].collapse}}]).controller("MainCtrl",["$scope","$location","$anchorScroll",function(a,b,c){a.scrollToElement=function(a){b.hash(a),c()}}]).controller("RouteMapCtrl",["$scope","RouteService","selectedShift",function(a,b,c){var d={draggable:!0},e=new google.maps.DirectionsService,f=new google.maps.DirectionsRenderer(d);f.setPanel(document.getElementById("directionsPanel")),a.map={center:{latitude:22.391,longitude:114.0878},zoom:12,control:{},options:{disableDefaultUI:!1}},a.dropDownOptions={selectedShift:c,selectedRoute:void 0,shifts:b.getShifts(),routeArray:[],disabled:!0,selectedLatlngs:[]};var g=function(b){console.log(b),a.dropDownOptions.routeArray=[],a.dropDownOptions.selectedRoute=void 0,a.dropDownOptions.selectedLatlngs=[],a.dropDownOptions.disabled=!0},h=function(c){var d=c;if(a.dropDownOptions.selectedLatlngs=null,a.dropDownOptions.disabled=!0,_.isNull(d)&&(d=[]),_.isEmpty(d)===!1){var e=d[0].id;a.dropDownOptions.selectedRoute=e;var f=null;_.isEqual(a.dropDownOptions.selectedShift,"Day")?f=b.getDayLatLngs(e):_.isEqual(a.dropDownOptions.selectedShift,"Night")?f=b.getNightLatLngs(e):_.isEqual(a.dropDownOptions.selectedShift,"Meeting")&&(f=b.getMeetingLatLngs(e)),_.isNull(f)||f.then(function(b){a.dropDownOptions.selectedLatlngs=b.stop_name,a.dropDownOptions.disabled=!1,j()})}a.dropDownOptions.routeArray=d},i=function(a){a.then(h,g)},j=function(){f.setMap(null);var b=a.map.control.getGMap();if(!_.isNull(b)){f.setMap(b);var c=a.dropDownOptions.selectedLatlngs;if(!_.isNull(c)&&!_.isEmpty(c)){var d=_.first(c),g=_.last(c),h=_.size(c),i=[];h>2&&_.forEach(c,function(a,b){b>=1&&h-1>b&&i.push({location:new google.maps.LatLng(a.lat,a.lng),stopover:!0})},i);var j={origin:new google.maps.LatLng(d.lat,d.lng),destination:new google.maps.LatLng(g.lat,g.lng),waypoints:i,travelMode:google.maps.TravelMode.DRIVING};e.route(j,function(a,b){_.isEqual(b,google.maps.DirectionsStatus.OK)&&f.setDirections(a)})}}};a.chooseRoute=function(c){var d=null,e=_.parseInt(c);_.isEqual(a.dropDownOptions.selectedShift,"Day")?d=b.getDayLatLngs(e):_.isEqual(a.dropDownOptions.selectedShift,"Night")?d=b.getNightLatLngs(e):_.isEqual(a.dropDownOptions.selectedShift,"Meeting")&&(d=b.getMeetingLatLngs(e)),_.isNull(d)?a.dropDownOptions.selectedLatlngs=null:d.then(function(b){a.dropDownOptions.selectedLatlngs=b.stop_name,j()})},a.chooseShift=function(c){a.dropDownOptions.routeArray=[],a.dropDownOptions.selectedRoute=void 0,a.dropDownOptions.disabled=!0,a.dropDownOptions.selectedLatlngs=[],f.setMap(null),_.isEqual("Day",c)?i(b.getDayRouteNames()):_.isEqual("Night",c)?i(b.getNightRouteNames()):_.isEqual("Meeting",c)&&i(b.getMeetingRouteNames())},a.chooseShift(a.dropDownOptions.selectedShift)}]).controller("CreateRouteCtrl",["$scope",function(a){var b={suppressMarkers:!0,draggable:!1},c=new google.maps.DirectionsService,d=new google.maps.DirectionsRenderer(b);d.setPanel(document.getElementById("directionsPanel")),a.routes=[],a.sciencePark={name:"10 Science Park W Ave"},a.fullRoutes=[],a.myMarkers=[],a.map={center:{latitude:22.391,longitude:114.0878},zoom:12,control:{},options:{disableDefaultUI:!1}},a.options={types:"geocode",country:"hk",watchEnter:!1},a.addRow=function(){a.routes.push({name:""})},a.removeRow=function(b){_.isEmpty(a.routes)||(_.isEqual(b,0)?a.routes.shift():_.isEqual(b,a.routes.length-1)?a.routes.pop():a.routes.splice(b,1))},a.insertAfterRow=function(b){a.routes.splice(b+1,0,{name:""})};var e=function(){a.fullRoutes=_.clone(a.routes,!0),a.fullRoutes.push(a.sciencePark);for(var b=[],c=10,d=0,e=a.fullRoutes.length>0;e;){for(var f=[],g=0,h=d;h<a.fullRoutes.length&&(g++,f.push({location:a.fullRoutes[h].name,stopover:!0}),!_.isEqual(g,c));h++);d+=g,b.push(f),e=d<a.fullRoutes.length,d--}return b},f=function(){_.each(a.myMarkers,function(a){a.setMap(null)}),a.myMarkers=[]},g=new google.maps.InfoWindow,h=function(a,b,c,d){var e="https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld="+c+"|FF0000|000000",f=new google.maps.Marker({position:a,map:b,icon:e});return google.maps.event.addListener(f,"click",function(){g.setContent(d),g.open(b,f)}),f},i=function(b,c){if(f(),_.isArray(b)){var d=null,e=_.size(b),g=_.first(b);d=h(g.start_location,c,1,g.start_address),a.myMarkers.push(d),e>1&&_.each(b,function(b,e){d=h(b.end_location,c,e+2,b.end_address),a.myMarkers.push(d)});var i=_.last(b);d=h(i.end_location,c,e+1,i.end_address),a.myMarkers.push(d)}};a.calRoute=function(){d.setMap(null);var b=a.map.control.getGMap();if(_.isNull(b)===!1){d.setMap(b);for(var f,g=e(),h=[{}],j=0,k=0;k<g.length;k++){var l=g[k].length-1,m=g[k][0].location,n=g[k][l].location,o=[];o=g[k],o.splice(0,1),o.splice(o.length-1,1);var p={origin:m,destination:n,waypoints:o,travelMode:window.google.maps.TravelMode.DRIVING};!function(a){c.route(p,function(c,e){if(_.isEqual(e,window.google.maps.DirectionsStatus.OK)){var k={order:a,result:c};if(h.push(k),j++,_.isEqual(j,g.length)){h.sort(function(a,b){return parseFloat(a.order)-parseFloat(b.order)});var l=0;for(var m in h)_.isObject(h[m].result)&&_.has(h,m)&&(_.isEqual(l,0)?f=h[m].result:(f.routes[0].legs=f.routes[0].legs.concat(h[m].result.routes[0].legs),f.routes[0].overview_path=f.routes[0].overview_path.concat(h[m].result.routes[0].overview_path),f.routes[0].bounds=f.routes[0].bounds.extend(h[m].result.routes[0].bounds.getNorthEast()),f.routes[0].bounds=f.routes[0].bounds.extend(h[m].result.routes[0].bounds.getSouthWest())),l++);_.isArray(f.routes)&&_.isObject(f.routes[0])&&i(f.routes[0].legs,b),d.setDirections(f)}}})}(k)}}}}]);var app=angular.module("routeMapDirective",[]);app.directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]).directive("appAuthor",["author",function(a){return function(b,c){c.text(a)}}]);var app=angular.module("routeMapServices",[]);app.value("version","0.0.2").value("author","Connie Leung").factory("RouteService",["Restangular",function(a){return{getShifts:function(){return["Day","Night","Meeting"]},getDayLatLngs:function(b){return a.all("route/morning").get(b)},getDayRouteNames:function(){return a.all("route/names/morning").getList()},getNightLatLngs:function(b){return a.all("route/evening").get(b)},getNightRouteNames:function(){return a.all("route/names/evening").getList()},getMeetingLatLngs:function(b){return a.all("route/meeting").get(b)},getMeetingRouteNames:function(){return a.all("route/names/meeting").getList()}}}]);